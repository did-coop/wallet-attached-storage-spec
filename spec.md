## Introduction

### Overview

### Goals

### Anti-Goals

### Core Concepts

## Terminology

<dl class="termlist definitions" data-sort="ascending">
</dl>

## Authorization

## Spaces

### Space Data Model

`Space` properties:

* `id` - Deterministically set by server if not provided.
* `type` - A sorted array of strings, MUST include the type `Space`.
* `name` (optional) - An arbitrary human-readable name for the space. Does not
  have to be unique.
* `controller` - Determined by server based on who creates the space originally.

#### Space JSON Representation

#### Space CBOR Representation

### Create Space operation

To create a Space:

* Perform an authenticated Create Space operation that includes a Proof of
  (cryptographic material) Possession via a mechanism such as HTTP Signatures.
* The signing DID (from the proof of possession signature) is set as the 
  Space's `controller`

* If an `id` is provided in the Create Space request, it must start with `urn:uuid`.
  If no `id` is provided, it will be generated by the storage server.

* (Optional, out of scope) A given storage provider MAY impose additional
  requirements in order to create a Space for a given controller, such as:
  - a Verifiable Credential representing a pre-arranged onboarding coupon
  - a proof of payment
  - a proof of membership in an organization

#### (HTTP API) POST `/spaces/`

To create a space via HTTP API:

```http
POST /spaces/ HTTP/1.1
Host: example.com
Accept: application/json
Content-type: application/json
Authorization: ...

{
  "name": "Example space #1"
}
```

Example success response:

```http
HTTP/1.1 201 Created
Content-type: application/json
Location: https://example.com/spaces/81246131-69a4-45ab-9bff-9c946b59cf2e

{
  "id": "81246131-69a4-45ab-9bff-9c946b59cf2e",
  "type": ["Space"],
  "name": "Example space #1",
  "controller": "did:key:z6MkpBMbMaRSv5nsgifRAwEKvHHoiKDMhiAHShTFNmkJNdVW"
}
```

Example error response (missing Proof of Possession signature, unable to 
determine controller):

Example error response (invalid authorization):

Example error response (missing or insufficient onboarding material provided):

Example error response (invalid `id` provided):

Example error response (a space with the specified `id` already exists):

#### (Javascript API) Space .create()

### Read Space operation

* Requires appropriate authorization (root zcap invoked by the space's controller,
  or a zcap granting permission to read a particular space)
* Returns the details for the specified space `id`

#### (HTTP API) GET `/spaces/{space_id}`

Example request:

```http
GET /spaces/81246131-69a4-45ab-9bff-9c946b59cf2e HTTP/1.1
Host: example.com
Accept: application/json
Authorization: Signature keyId="did:key:z6MkpBMbMaRSv5nsgifRAwEKvHHoiKDMhiAHShTFNmkJNdVW#z6MkpBMbMaRSv5nsgifRAwEKvHHoiKDMhiAHShTFNmkJNdVW" ...
```

Example success response:

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  "id": "81246131-69a4-45ab-9bff-9c946b59cf2e",
  "type": ["Space"],
  "name": "Example space #1",
  "controller": "did:key:z6MkpBMbMaRSv5nsgifRAwEKvHHoiKDMhiAHShTFNmkJNdVW"
}
```

Example error response (missing or insufficient authorization):

Example error response (space id not found):

### List Spaces Operation

* Requires appropriate authorization (root zcap invoked by the controller of one
  or more spaces, or a zcap granting permission to read a one or more spaces)

* Lists only the spaces the requester is authorized to see

#### (HTTP API) GET `/spaces/`

Example request:

```http
GET /spaces/ HTTP/1.1
Host: example.com
Accept: application/json
Authorization: ...
```

Example success response (requester has read access to at least one space):

```http
HTTP/1.1 200 OK
Content-type: application/json

...
```

Example success response (requester does NOT have access to any spaces):

```http
HTTP/1.1 200 OK
Content-type: application/json

...
```

Example error response (missing authorization):

### Update Space operation

* Requires appropriate authorization (root zcap invoked by the space's controller,
  or a zcap granting permission to write to a particular space)
* Allows to update the following fields:
  - `name`
  - `controller`

#### (HTTP API) PUT `/spaces/{space_id}`

Note that this is a _full_ update (partial updates via http `PATCH` verb might
be supported later). However, some fields may not be updated (like `id`) and so
may be omitted from the request payload.

Note that this operation is idempotent.

Example request (updating the name of a space):

```http
PUT /spaces/81246131-69a4-45ab-9bff-9c946b59cf2e HTTP/1.1
Host: example.com
Content-type: application/json
Accept: application/json
Authorization: ...

{
  "id": "81246131-69a4-45ab-9bff-9c946b59cf2e",
  "name": "Newly renamed space #1",
  "controller": "did:key:z6MkpBMbMaRSv5nsgifRAwEKvHHoiKDMhiAHShTFNmkJNdVW"
}
```

Example success response (returns the updated details of the space):

```http
HTTP/1.1 200 OK
Content-type: application/json
Location: https://example.com/spaces/81246131-69a4-45ab-9bff-9c946b59cf2e

{
  "id": "81246131-69a4-45ab-9bff-9c946b59cf2e",
  "type": ["Space"],
  "name": "Newly renamed space #1",
  "controller": "did:key:z6MkpBMbMaRSv5nsgifRAwEKvHHoiKDMhiAHShTFNmkJNdVW"
}
```

Example error response (missing or invalid authorization):

Example error response (invalid `id` provided, the space does not exist):

Example error response (client is attempting to change an immutable field like
the space `id`):

### Delete Space operation

* Requires appropriate authorization (root zcap invoked by the space's controller,
  or a zcap granting permission to write to a particular space)
* Deletes the space and all of the data (collections and resources) contained
  in it
* Server responds with a Tombstone object (which will be later used for replication)
* This operation is idempotent

#### (HTTP API) DELETE `/spaces/{space_id}`

Example request (no request body):

```http
DELETE /spaces/81246131-69a4-45ab-9bff-9c946b59cf2e HTTP/1.1
Host: example.com
Accept: application/json
Authorization: ...
```

Example success response:

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  ... TODO: specify Tombstone format
}
```

TODO: Decide whether subsequent GET requests to the same space should result in
a 410 Gone, or the usual 404.

Example error response (missing or invalid authorization):

Example error response (invalid `id` provided):

## Collections

### Collection Data Model

#### Collection JSON Representation (ActivityPub profile)

#### Collection CBOR Representation

### Collection Operations

#### Collection HTTP API

#### Collection Javascript Client API

## Resources and Blobs

### Blob Data Model

### Resource Data Model

### Resource Operations

#### Resource HTTP API

#### Resource Javascript Client API

## Security and Privacy Considerations

## Internationalization Considerations

### Language and Base Direction

<section class="appendix informative">

## IANA Considerations

This section will be submitted to the Internet Engineering Steering Group (IESG)
for review, approval, and registration with IANA.
</section>

